#!/bin/bash

# a trusted header
# regtest snapshot
INIT_HEADERS='[0x00000020bc51234daa2265cbd5bf05e5ce37c0837eb469fb81acb8aa4438000000000000a435c0454ecc0dd0bee74a287c2a2170de47ba52ed4c499b5fe69af5ee4ce5cc421893678cbe0519f72a8854,0x000000207f8c5e27739fe7a292036c0e5f026a2a7bdcf270b4e57b580100000000000000fbf7d6bd22b71af36ce08c4419ce8f5b6a402eb7d1b86dd7c8d827a1c2614c10f31c9367ffff001daeed7248,0x00000020c4bb22e4c4d14c87a0a7b5579d4dbc32363f88e345e3874c0712000000000000b85b073df4985952f1ccd4a7c16fd25203c876b4dd64ad0b6faeb62d0669df5aa4219367ffff001d9e0b02e7,0x000000206f00323f6dbfc2ed417bd514ba438ec219595e5c92551f1c3b820000000000000705752ed1968aa52271e67e94dbce81c434ccb22e51ed0354a83ad865ceed76921393678cbe0519c4f9ce14,0x000000206a628b21c51ef40152a675c79e079797573d1da3f94bd46f0300000000000000abcc599cddbfb5f169a8ff397f2c46bd6596e896f6f950b881b29cac9133cdfe43189367ffff001d6de1b70a,0x000000202a39641ed77019926415ff4e9bf8dbb7f5a852fd7f1d85675f79000000000000e0fde14e8382c5a62468c829bfbe226ccb4464b6b54d68b7609421b9ef5d21a1f41c9367ffff001d0423290c,0x0000002081f15ed77d3107b423fd16d237257dec8f658ab38d73ed238b5b000000000000b66667bef9b82c14962c242387c4a9fae48e029617ff477134c26125bdf5a762a5219367ffff001de67d50c0,0x0000002051c6a2705bf9a4049617e02bcf46f9d2d2923d3dd2a4f7f755910000000000000ed10c3c67578c118d37fd5b761d195f58b85a616de5a1a6a024d0206b984cd656269367ffff001d15b16dbb,0x0000002038a67297c4f214602b60ecd4f8d00558ec11b4cbd105330f08b9ac9400000000a484fc2fe467f19fae2db2e6403a56dcb5589130e61c90e81e3e047424cbfe25072b9367ffff001d00a22777,0x000000204ffea333f98d7e39c3a51c6ab170f0a6185c0d7f5594fe0b44f973b200000000fc50f6a912052cfca27b42f50bdcbbda4a95e789e338f7ff477535f6e63f1b18b82f9367ffff001d10b42bb0,0x0000002000007b95724c92368d63900620b4f5c60a4c94281f9c2d25b8816ffe00000000ed03bf1caa38bc0d57a4dcec1d9e5209722a6223130e97810f7dafc35fdca53e69349367ffff001d5fd9d952,0x00000020d2bb3b3138d7dccd97248b6061ce7bdf8f70a60cf385b21a6fdedcbb00000000ad672ec9194fc8f66c0ee228bff759068f54ace638dd176f20387ddf59d9f33b1a399367ffff001d403bee8a]'

# a list of header follow a init header
HEADERS_FOR_INSERT='[0x00000030e98bb046cd25a629c91f0c7623cc2ed0c12ef6db5e41956536c261eb673d0b0f813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f39c5b167ffff7f2004000000,0x000000304f58550f49b5c9dce6328bc8d7b8f5941823efcc51741a024c17d9745ba21111cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d452539c5b167ffff7f2004000000,0x00000030aa8bd6ce82edf1f9c03abc2243281f622594bc3aec5106a17f612371f76060084e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a39c5b167ffff7f2003000000]'

# a list of header this create fork, and more powerful than current chain
HEADERS_FOR_FORK='[0x000000307306011c31d1f14a422c50c70cbedb1233757505cb887d82d51ae3f27e23062d6be46c161e69696c1c83ba3a1ea52f071fcdada5a6bce28f5da591b969b42da19dc5b167ffff7f2001000000,0x000000302ba076eb907ec3c060954d36dfcf0e735c815c9531f6d44667aa32f5999f412d813b60988eadd1961289bf5f2098f6ca0c7dd35ae95e78807c6582a46e00107f9dc5b167ffff7f2001000000,0x00000030525bda2756ff6f9e440c91590490462ac33e0fedb05b1558cfd3f7ce90920d16cb2db51b4bf0858c2318820adafa1c8640703dca1faceea0205f388f160d45259dc5b167ffff7f2002000000,0x000000306052592f4f0e4886a0eca2c1d154e8b9761e011b4f7b3a00908e2a830f7f6c6a4e05aaf29bda3424553cb4636006d006030690b91875fe96fdb4c52d4a38ba8a9dc5b167ffff7f2001000000,0x000000309c32ae8f3b099ea17563bb425476cf962b84269e09d17e19350b819695970f2cdebd5d70e4be4f6f5cc474416137a697f1fca22bf87e9066eb9b43dd7882d2329dc5b167ffff7f2001000000,0x000000307370f207ef4945a89b10b1c60a14770136109de093df4544340251190a5c2436494bba4bf2f3dc3a1d8c1bb592eeadc16c77b6bdd42c6ad2003a704641c3caeb9dc5b167ffff7f2000000000,0x000000305e52d670c3efd5ff9152b325f6cf2c59154b856215a99c8101efc51688937e734ca6a58af04afaa3eea3d8c6fa6c29eb0454a7e18d5953a1766ab994152f5f169ec5b167ffff7f2005000000,0x00000030e61a86ad71115af58d3e2ab5280a4423920b5311094403376b563b2fc09e9843240a1d2cf05759689835b13573161887f2c284aece535a39642db5d5bf2588e59ec5b167ffff7f2002000000]'

BTC_NETWORK=1 # 0 = mainnet, 1 = testnet, otherwise = regtest

PACKAGE_ID="0xc31478c4cc6cc146a7ecfc9cc5096d4421d675bdf5577cb7e550392a7cb93dc5"

# Create a new light client
function create_light_client() {
    sui client call --function init_light_client_network --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $BTC_NETWORK 66528 $INIT_HEADERS 0
}

# get object SPV
# You can use sui explored for more information
function client_object() {
    LC_ID=$1
    sui client object $LC_ID
}

# Insert a new headers
function insert_headers() {
    echo "We extend a current chain"
    echo $HEADERS_FOR_INSERT
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_INSERT
}

# Insert a new headers with fork potential
function insert_headers_fork_potential() {
    echo "We insert a list header can create fork"
    echo $HEADERS_FOR_FORK
    LC_ID=$1
    sui client call --function insert_headers --module light_client --package $PACKAGE_ID --gas-budget 100000000 --args $LC_ID $HEADERS_FOR_FORK
}

# Get last block
function head() {
    LC_ID=$1
    sui client call --function head --module light_client --package $PACKAGE_ID --gas-budget 10000000 --args $LC_ID --dev-inspect
}

case "$1" in
create_lc)
    create_light_client
    ;;
insert_headers)
    insert_headers $2
    ;;
insert_headers_fork)
    insert_headers_fork_potential $2
    ;;
head)
    head $2
    ;;
lc_object)
    client_object $2
    ;;
*)
    echo "Invalid option."
    exit 1
    ;;
esac
